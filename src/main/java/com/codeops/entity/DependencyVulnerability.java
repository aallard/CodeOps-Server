package com.codeops.entity;

import com.codeops.entity.enums.Severity;
import com.codeops.entity.enums.VulnerabilityStatus;
import jakarta.persistence.*;
import lombok.*;

@Entity
@Table(name = "dependency_vulnerabilities", indexes = {
        @Index(name = "idx_vuln_scan_id", columnList = "scan_id")
})
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class DependencyVulnerability extends BaseEntity {

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "scan_id", nullable = false)
    private DependencyScan scan;

    @Column(name = "dependency_name", nullable = false, length = 200)
    private String dependencyName;

    @Column(name = "current_version", length = 50)
    private String currentVersion;

    @Column(name = "fixed_version", length = 50)
    private String fixedVersion;

    @Column(name = "cve_id", length = 30)
    private String cveId;

    @Enumerated(EnumType.STRING)
    @Column(name = "severity", nullable = false)
    private Severity severity;

    @Column(name = "description", columnDefinition = "TEXT")
    private String description;

    @Builder.Default
    @Enumerated(EnumType.STRING)
    @Column(name = "status", columnDefinition = "varchar(20) default 'OPEN'")
    private VulnerabilityStatus status = VulnerabilityStatus.OPEN;
}
