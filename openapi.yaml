openapi: 3.0.3
info:
  title: CodeOps-Server API
  description: >-
    REST API for CodeOps — an AI-powered software maintenance platform.
    Provides QA job orchestration, agent-based code analysis, compliance tracking,
    dependency scanning, tech debt management, health monitoring, and team collaboration.
  version: 1.0.0

servers:
  - url: http://localhost:8090
    description: Local development

security:
  - bearerAuth: []

tags:
  - name: Health
    description: Public health check endpoint
  - name: Authentication
    description: User registration, login, token refresh, logout, and password management
  - name: Admin
    description: Administrative operations (user management, settings, audit logs)
  - name: Users
    description: User account management
  - name: Teams
    description: Team CRUD, member management, and invitation workflows
  - name: Projects
    description: Project management within teams
  - name: Directives
    description: Directive CRUD and project assignment
  - name: Personas
    description: AI agent persona management
  - name: QA Jobs
    description: QA job lifecycle, agent runs, and bug investigations
  - name: Findings
    description: QA finding management and status updates
  - name: Compliance
    description: Compliance specifications and items
  - name: Dependencies
    description: Dependency scanning and vulnerability management
  - name: Tech Debt
    description: Technical debt tracking and management
  - name: Remediation Tasks
    description: Remediation task management
  - name: Health Monitor
    description: Project health schedule and snapshot management
  - name: Metrics
    description: Project and team metrics
  - name: Reports
    description: Report and specification file upload/download
  - name: Integrations
    description: Third-party integration connections (GitHub, Jira)

paths:
  # ──────────────────────────────────────────────
  # Health
  # ──────────────────────────────────────────────
  /api/v1/health:
    get:
      tags: [Health]
      operationId: healthCheck
      summary: Check server health
      security: []
      responses:
        '200':
          description: Server is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: UP
                  service:
                    type: string
                    example: codeops-server
                  timestamp:
                    type: string
                    format: date-time

  # ──────────────────────────────────────────────
  # Authentication
  # ──────────────────────────────────────────────
  /api/v1/auth/register:
    post:
      tags: [Authentication]
      operationId: register
      summary: Register a new user
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /api/v1/auth/login:
    post:
      tags: [Authentication]
      operationId: login
      summary: Authenticate user and obtain JWT tokens
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /api/v1/auth/refresh:
    post:
      tags: [Authentication]
      operationId: refreshToken
      summary: Refresh an expired access token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: Tokens refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /api/v1/auth/logout:
    post:
      tags: [Authentication]
      operationId: logout
      summary: Logout and blacklist the current JWT token
      parameters:
        - name: Authorization
          in: header
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Logged out successfully

  /api/v1/auth/change-password:
    post:
      tags: [Authentication]
      operationId: changePassword
      summary: Change the current user's password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '200':
          description: Password changed successfully

  # ──────────────────────────────────────────────
  # MFA (Multi-Factor Authentication)
  # ──────────────────────────────────────────────
  /api/v1/auth/mfa/setup:
    post:
      tags: [Authentication]
      operationId: mfaSetup
      summary: Initiate MFA setup (generates TOTP secret and recovery codes)
      description: >-
        Requires authentication. The user must provide their current password.
        Returns a TOTP secret, a QR code data URI, and 8 one-time recovery codes.
        MFA is NOT enabled until verified via /mfa/verify.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MfaSetupRequest'
      responses:
        '200':
          description: MFA setup initiated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MfaSetupResponse'
        '400':
          description: MFA already enabled or wrong password

  /api/v1/auth/mfa/verify:
    post:
      tags: [Authentication]
      operationId: mfaVerify
      summary: Verify a TOTP code and enable MFA
      description: >-
        Requires authentication. Second step of MFA setup — submits a TOTP code
        from the authenticator app to activate MFA on the account.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MfaVerifyRequest'
      responses:
        '200':
          description: MFA enabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MfaStatusResponse'
        '400':
          description: Invalid TOTP code or MFA not set up

  /api/v1/auth/mfa/login:
    post:
      tags: [Authentication]
      operationId: mfaLogin
      summary: Complete MFA-challenged login with TOTP code, email code, or recovery code
      security: []
      description: >-
        Publicly accessible. Submits the MFA challenge token (from login) along
        with a 6-digit TOTP code, 6-digit email code, or 8-digit recovery code.
        On success, returns full access and refresh tokens.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MfaLoginRequest'
      responses:
        '200':
          description: MFA verified, tokens issued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Invalid challenge token or MFA code

  /api/v1/auth/mfa/disable:
    post:
      tags: [Authentication]
      operationId: mfaDisable
      summary: Disable MFA for the current user
      description: >-
        Requires authentication. Clears the TOTP secret, email codes, and recovery codes.
        Resets the MFA method to NONE. The user must provide their current password.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MfaSetupRequest'
      responses:
        '200':
          description: MFA disabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MfaStatusResponse'
        '400':
          description: MFA not enabled or wrong password

  /api/v1/auth/mfa/recovery-codes:
    post:
      tags: [Authentication]
      operationId: mfaRegenerateRecoveryCodes
      summary: Regenerate MFA recovery codes
      description: >-
        Requires authentication. MFA must be enabled. Replaces all existing
        recovery codes with a new set of 8 codes.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MfaSetupRequest'
      responses:
        '200':
          description: New recovery codes generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MfaRecoveryResponse'
        '400':
          description: MFA not enabled or wrong password

  /api/v1/auth/mfa/status:
    get:
      tags: [Authentication]
      operationId: mfaGetStatus
      summary: Get MFA status for the current user
      responses:
        '200':
          description: MFA status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MfaStatusResponse'

  /api/v1/auth/mfa/setup/email:
    post:
      tags: [Authentication]
      operationId: emailMfaSetup
      summary: Initiate email MFA setup (generates recovery codes and sends verification code)
      description: >-
        Requires authentication. The user must provide their current password.
        Generates 8 one-time recovery codes, sets the MFA method to EMAIL, and sends a
        6-digit verification code to the user's registered email.
        MFA is NOT enabled until verified via /mfa/verify-setup/email.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MfaEmailSetupRequest'
      responses:
        '200':
          description: Email MFA setup initiated, recovery codes returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MfaRecoveryResponse'
        '400':
          description: MFA already enabled or wrong password

  /api/v1/auth/mfa/verify-setup/email:
    post:
      tags: [Authentication]
      operationId: emailMfaVerifySetup
      summary: Verify email code and enable email MFA
      description: >-
        Requires authentication. Second step of email MFA setup — submits the 6-digit
        code received via email to activate email MFA on the account.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MfaVerifyRequest'
      responses:
        '200':
          description: Email MFA enabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MfaStatusResponse'
        '400':
          description: Invalid code or email MFA setup not initiated

  /api/v1/auth/mfa/resend:
    post:
      tags: [Authentication]
      operationId: mfaResendCode
      summary: Resend MFA login code to the user's email
      security: []
      description: >-
        Publicly accessible. Sends a new 6-digit MFA code to the user's email during
        the email MFA login flow. Requires a valid MFA challenge token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MfaResendRequest'
      responses:
        '200':
          description: Code resent
        '400':
          description: Invalid challenge token or email MFA not enabled

  # ──────────────────────────────────────────────
  # Admin
  # ──────────────────────────────────────────────
  /api/v1/admin/users:
    get:
      tags: [Admin]
      operationId: adminGetAllUsers
      summary: List all users (paginated)
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated list of users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageUserResponse'

  /api/v1/admin/users/{userId}:
    get:
      tags: [Admin]
      operationId: adminGetUserById
      summary: Get a user by ID
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
    put:
      tags: [Admin]
      operationId: adminUpdateUserStatus
      summary: Update a user's administrative properties
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUpdateUserRequest'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'

  /api/v1/admin/settings:
    get:
      tags: [Admin]
      operationId: adminGetAllSettings
      summary: List all system settings
      responses:
        '200':
          description: All system settings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SystemSettingResponse'
    put:
      tags: [Admin]
      operationId: adminUpdateSystemSetting
      summary: Update a system setting
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSystemSettingRequest'
      responses:
        '200':
          description: Setting updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemSettingResponse'

  /api/v1/admin/settings/{key}:
    get:
      tags: [Admin]
      operationId: adminGetSystemSetting
      summary: Get a system setting by key
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: System setting details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemSettingResponse'

  /api/v1/admin/usage:
    get:
      tags: [Admin]
      operationId: adminGetUsageStats
      summary: Get platform usage statistics
      responses:
        '200':
          description: Usage statistics
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /api/v1/admin/audit-log/team/{teamId}:
    get:
      tags: [Admin]
      operationId: adminGetTeamAuditLog
      summary: Get audit log for a team (paginated)
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated audit log
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageAuditLogResponse'

  /api/v1/admin/audit-log/user/{userId}:
    get:
      tags: [Admin]
      operationId: adminGetUserAuditLog
      summary: Get audit log for a user (paginated)
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated audit log
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageAuditLogResponse'

  /api/v1/admin/users/{userId}/reset-mfa:
    post:
      tags: [Admin]
      operationId: adminResetUserMfa
      summary: Force-reset MFA for a user (admin only)
      description: >-
        Requires authentication with admin privileges. Force-disables MFA for the
        target user without requiring their password. Used when a user is locked out.
        Logs an ADMIN_MFA_RESET audit entry.
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: MFA reset confirmation
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: MFA reset successfully
                  userId:
                    type: string
                    format: uuid
        '404':
          description: User not found

  # ──────────────────────────────────────────────
  # Users
  # ──────────────────────────────────────────────
  /api/v1/users/me:
    get:
      tags: [Users]
      operationId: getCurrentUser
      summary: Get the current authenticated user's profile
      responses:
        '200':
          description: Current user details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'

  /api/v1/users/{id}:
    get:
      tags: [Users]
      operationId: getUserById
      summary: Get a user by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
    put:
      tags: [Users]
      operationId: updateUser
      summary: Update a user's profile
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'

  /api/v1/users/search:
    get:
      tags: [Users]
      operationId: searchUsers
      summary: Search users by name or email
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 2
            maxLength: 100
      responses:
        '200':
          description: Matching users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'

  /api/v1/users/{id}/deactivate:
    put:
      tags: [Users]
      operationId: deactivateUser
      summary: Deactivate a user account (ADMIN/OWNER)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: User deactivated

  /api/v1/users/{id}/activate:
    put:
      tags: [Users]
      operationId: activateUser
      summary: Activate a user account (ADMIN/OWNER)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: User activated

  # ──────────────────────────────────────────────
  # Teams
  # ──────────────────────────────────────────────
  /api/v1/teams:
    post:
      tags: [Teams]
      operationId: createTeam
      summary: Create a new team
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTeamRequest'
      responses:
        '201':
          description: Team created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamResponse'
    get:
      tags: [Teams]
      operationId: getTeams
      summary: Get teams for the current user
      responses:
        '200':
          description: List of teams
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TeamResponse'

  /api/v1/teams/{teamId}:
    get:
      tags: [Teams]
      operationId: getTeam
      summary: Get a team by ID
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Team details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamResponse'
    put:
      tags: [Teams]
      operationId: updateTeam
      summary: Update a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTeamRequest'
      responses:
        '200':
          description: Team updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamResponse'
    delete:
      tags: [Teams]
      operationId: deleteTeam
      summary: Delete a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Team deleted

  /api/v1/teams/{teamId}/members:
    get:
      tags: [Teams]
      operationId: getTeamMembers
      summary: List members of a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Team members
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TeamMemberResponse'

  /api/v1/teams/{teamId}/members/{userId}/role:
    put:
      tags: [Teams]
      operationId: updateMemberRole
      summary: Update a team member's role
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateMemberRoleRequest'
      responses:
        '200':
          description: Member role updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamMemberResponse'

  /api/v1/teams/{teamId}/members/{userId}:
    delete:
      tags: [Teams]
      operationId: removeMember
      summary: Remove a member from a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Member removed

  /api/v1/teams/{teamId}/invitations:
    post:
      tags: [Teams]
      operationId: inviteMember
      summary: Invite a user to a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InviteMemberRequest'
      responses:
        '201':
          description: Invitation created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvitationResponse'
    get:
      tags: [Teams]
      operationId: getTeamInvitations
      summary: List pending invitations for a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Pending invitations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InvitationResponse'

  /api/v1/teams/{teamId}/invitations/{invitationId}:
    delete:
      tags: [Teams]
      operationId: cancelInvitation
      summary: Cancel a pending invitation
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: invitationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Invitation cancelled

  /api/v1/teams/invitations/{token}/accept:
    post:
      tags: [Teams]
      operationId: acceptInvitation
      summary: Accept a team invitation by token
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Invitation accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamResponse'

  # ──────────────────────────────────────────────
  # Projects
  # ──────────────────────────────────────────────
  /api/v1/projects/{teamId}:
    post:
      tags: [Projects]
      operationId: createProject
      summary: Create a new project within a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '201':
          description: Project created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectResponse'

  /api/v1/projects/team/{teamId}:
    get:
      tags: [Projects]
      operationId: getProjects
      summary: List projects for a team (paginated)
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: includeArchived
          in: query
          schema:
            type: boolean
            default: false
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated projects
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseProjectResponse'

  /api/v1/projects/{projectId}:
    get:
      tags: [Projects]
      operationId: getProject
      summary: Get a project by ID
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Project details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectResponse'
    put:
      tags: [Projects]
      operationId: updateProject
      summary: Update a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectRequest'
      responses:
        '200':
          description: Project updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectResponse'
    delete:
      tags: [Projects]
      operationId: deleteProject
      summary: Delete a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Project deleted

  /api/v1/projects/{projectId}/archive:
    put:
      tags: [Projects]
      operationId: archiveProject
      summary: Archive a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Project archived

  /api/v1/projects/{projectId}/unarchive:
    put:
      tags: [Projects]
      operationId: unarchiveProject
      summary: Unarchive a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Project unarchived

  # ──────────────────────────────────────────────
  # Directives
  # ──────────────────────────────────────────────
  /api/v1/directives:
    post:
      tags: [Directives]
      operationId: createDirective
      summary: Create a new directive
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDirectiveRequest'
      responses:
        '201':
          description: Directive created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DirectiveResponse'

  /api/v1/directives/{directiveId}:
    get:
      tags: [Directives]
      operationId: getDirective
      summary: Get a directive by ID
      parameters:
        - name: directiveId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Directive details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DirectiveResponse'
    put:
      tags: [Directives]
      operationId: updateDirective
      summary: Update a directive
      parameters:
        - name: directiveId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDirectiveRequest'
      responses:
        '200':
          description: Directive updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DirectiveResponse'
    delete:
      tags: [Directives]
      operationId: deleteDirective
      summary: Delete a directive
      parameters:
        - name: directiveId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Directive deleted

  /api/v1/directives/team/{teamId}:
    get:
      tags: [Directives]
      operationId: getDirectivesForTeam
      summary: List directives for a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Directives for team
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DirectiveResponse'

  /api/v1/directives/project/{projectId}:
    get:
      tags: [Directives]
      operationId: getDirectivesForProject
      summary: List directives assigned to a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Directives for project
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DirectiveResponse'

  /api/v1/directives/assign:
    post:
      tags: [Directives]
      operationId: assignDirectiveToProject
      summary: Assign a directive to a project
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignDirectiveRequest'
      responses:
        '201':
          description: Directive assigned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDirectiveResponse'

  /api/v1/directives/project/{projectId}/directive/{directiveId}:
    delete:
      tags: [Directives]
      operationId: removeDirectiveFromProject
      summary: Remove a directive assignment from a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: directiveId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Directive removed from project

  /api/v1/directives/project/{projectId}/assignments:
    get:
      tags: [Directives]
      operationId: getProjectDirectives
      summary: List project-directive assignments
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Project directive assignments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProjectDirectiveResponse'

  /api/v1/directives/project/{projectId}/enabled:
    get:
      tags: [Directives]
      operationId: getEnabledDirectives
      summary: List enabled directives for a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Enabled directives
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DirectiveResponse'

  /api/v1/directives/project/{projectId}/directive/{directiveId}/toggle:
    put:
      tags: [Directives]
      operationId: toggleDirective
      summary: Toggle a directive's enabled state for a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: directiveId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: enabled
          in: query
          required: true
          schema:
            type: boolean
      responses:
        '200':
          description: Directive toggled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectDirectiveResponse'

  # ──────────────────────────────────────────────
  # Personas
  # ──────────────────────────────────────────────
  /api/v1/personas:
    post:
      tags: [Personas]
      operationId: createPersona
      summary: Create a new persona
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePersonaRequest'
      responses:
        '201':
          description: Persona created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonaResponse'

  /api/v1/personas/{personaId}:
    get:
      tags: [Personas]
      operationId: getPersona
      summary: Get a persona by ID
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Persona details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonaResponse'
    put:
      tags: [Personas]
      operationId: updatePersona
      summary: Update a persona
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePersonaRequest'
      responses:
        '200':
          description: Persona updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonaResponse'
    delete:
      tags: [Personas]
      operationId: deletePersona
      summary: Delete a persona
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Persona deleted

  /api/v1/personas/team/{teamId}:
    get:
      tags: [Personas]
      operationId: getPersonasForTeam
      summary: List personas for a team (paginated)
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated personas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponsePersonaResponse'

  /api/v1/personas/team/{teamId}/agent/{agentType}:
    get:
      tags: [Personas]
      operationId: getPersonasByAgentType
      summary: List personas for a team filtered by agent type
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: agentType
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/AgentType'
      responses:
        '200':
          description: Personas for agent type
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PersonaResponse'

  /api/v1/personas/team/{teamId}/default/{agentType}:
    get:
      tags: [Personas]
      operationId: getDefaultPersona
      summary: Get the default persona for a team and agent type
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: agentType
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/AgentType'
      responses:
        '200':
          description: Default persona
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonaResponse'

  /api/v1/personas/mine:
    get:
      tags: [Personas]
      operationId: getMyPersonas
      summary: List personas owned by the current user
      responses:
        '200':
          description: User's personas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PersonaResponse'

  /api/v1/personas/system:
    get:
      tags: [Personas]
      operationId: getSystemPersonas
      summary: List system-level built-in personas
      responses:
        '200':
          description: System personas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PersonaResponse'

  /api/v1/personas/{personaId}/set-default:
    put:
      tags: [Personas]
      operationId: setPersonaAsDefault
      summary: Set a persona as the default for its team and agent type
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Persona set as default
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonaResponse'

  /api/v1/personas/{personaId}/remove-default:
    put:
      tags: [Personas]
      operationId: removePersonaDefault
      summary: Remove the default designation from a persona
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Default removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonaResponse'

  # ──────────────────────────────────────────────
  # QA Jobs
  # ──────────────────────────────────────────────
  /api/v1/jobs:
    post:
      tags: [QA Jobs]
      operationId: createJob
      summary: Create a new QA job
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateJobRequest'
      responses:
        '201':
          description: Job created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResponse'

  /api/v1/jobs/{jobId}:
    get:
      tags: [QA Jobs]
      operationId: getJob
      summary: Get a QA job by ID
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Job details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResponse'
    put:
      tags: [QA Jobs]
      operationId: updateJob
      summary: Update a QA job
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateJobRequest'
      responses:
        '200':
          description: Job updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResponse'
    delete:
      tags: [QA Jobs]
      operationId: deleteJob
      summary: Delete a QA job
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Job deleted

  /api/v1/jobs/project/{projectId}:
    get:
      tags: [QA Jobs]
      operationId: getJobsForProject
      summary: List job summaries for a project (paginated)
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated job summaries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseJobSummaryResponse'

  /api/v1/jobs/mine:
    get:
      tags: [QA Jobs]
      operationId: getMyJobs
      summary: List jobs created by the current user (paginated)
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated job summaries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseJobSummaryResponse'

  /api/v1/jobs/{jobId}/agents:
    post:
      tags: [QA Jobs]
      operationId: createAgentRun
      summary: Create an agent run within a job
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAgentRunRequest'
      responses:
        '201':
          description: Agent run created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentRunResponse'
    get:
      tags: [QA Jobs]
      operationId: getAgentRuns
      summary: List agent runs for a job
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Agent runs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AgentRunResponse'

  /api/v1/jobs/{jobId}/agents/batch:
    post:
      tags: [QA Jobs]
      operationId: createAgentRunsBatch
      summary: Create multiple agent runs for a job (one per agent type)
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/AgentType'
      responses:
        '201':
          description: Agent runs created
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AgentRunResponse'

  /api/v1/jobs/agents/{agentRunId}:
    put:
      tags: [QA Jobs]
      operationId: updateAgentRun
      summary: Update an agent run
      parameters:
        - name: agentRunId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAgentRunRequest'
      responses:
        '200':
          description: Agent run updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentRunResponse'

  /api/v1/jobs/{jobId}/investigation:
    get:
      tags: [QA Jobs]
      operationId: getInvestigation
      summary: Get the bug investigation for a job
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Bug investigation details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BugInvestigationResponse'
    post:
      tags: [QA Jobs]
      operationId: createInvestigation
      summary: Create a bug investigation for a job
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBugInvestigationRequest'
      responses:
        '201':
          description: Bug investigation created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BugInvestigationResponse'

  /api/v1/jobs/investigations/{investigationId}:
    put:
      tags: [QA Jobs]
      operationId: updateInvestigation
      summary: Update a bug investigation
      parameters:
        - name: investigationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBugInvestigationRequest'
      responses:
        '200':
          description: Bug investigation updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BugInvestigationResponse'

  # ──────────────────────────────────────────────
  # Findings
  # ──────────────────────────────────────────────
  /api/v1/findings:
    post:
      tags: [Findings]
      operationId: createFinding
      summary: Create a single finding
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFindingRequest'
      responses:
        '201':
          description: Finding created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FindingResponse'

  /api/v1/findings/batch:
    post:
      tags: [Findings]
      operationId: createFindings
      summary: Create multiple findings in batch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/CreateFindingRequest'
      responses:
        '201':
          description: Findings created
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FindingResponse'

  /api/v1/findings/{findingId}:
    get:
      tags: [Findings]
      operationId: getFinding
      summary: Get a finding by ID
      parameters:
        - name: findingId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Finding details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FindingResponse'

  /api/v1/findings/job/{jobId}:
    get:
      tags: [Findings]
      operationId: getFindingsForJob
      summary: List findings for a job (paginated)
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated findings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseFindingResponse'

  /api/v1/findings/job/{jobId}/severity/{severity}:
    get:
      tags: [Findings]
      operationId: getFindingsBySeverity
      summary: List findings for a job filtered by severity
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: severity
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Severity'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated findings by severity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseFindingResponse'

  /api/v1/findings/job/{jobId}/agent/{agentType}:
    get:
      tags: [Findings]
      operationId: getFindingsByAgent
      summary: List findings for a job filtered by agent type
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: agentType
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/AgentType'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated findings by agent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseFindingResponse'

  /api/v1/findings/job/{jobId}/status/{status}:
    get:
      tags: [Findings]
      operationId: getFindingsByStatus
      summary: List findings for a job filtered by status
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: status
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/FindingStatus'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated findings by status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseFindingResponse'

  /api/v1/findings/job/{jobId}/counts:
    get:
      tags: [Findings]
      operationId: getSeverityCounts
      summary: Get finding counts grouped by severity for a job
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Severity counts
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: integer
                  format: int64

  /api/v1/findings/{findingId}/status:
    put:
      tags: [Findings]
      operationId: updateFindingStatus
      summary: Update the status of a finding
      parameters:
        - name: findingId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateFindingStatusRequest'
      responses:
        '200':
          description: Finding status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FindingResponse'

  /api/v1/findings/bulk-status:
    put:
      tags: [Findings]
      operationId: bulkUpdateFindingStatus
      summary: Bulk update the status of multiple findings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkUpdateFindingsRequest'
      responses:
        '200':
          description: Findings updated
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FindingResponse'

  # ──────────────────────────────────────────────
  # Compliance
  # ──────────────────────────────────────────────
  /api/v1/compliance/specs:
    post:
      tags: [Compliance]
      operationId: createSpecification
      summary: Create a compliance specification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSpecificationRequest'
      responses:
        '201':
          description: Specification created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SpecificationResponse'

  /api/v1/compliance/specs/job/{jobId}:
    get:
      tags: [Compliance]
      operationId: getSpecificationsForJob
      summary: List specifications for a job (paginated)
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated specifications
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseSpecificationResponse'

  /api/v1/compliance/items:
    post:
      tags: [Compliance]
      operationId: createComplianceItem
      summary: Create a compliance item
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateComplianceItemRequest'
      responses:
        '201':
          description: Compliance item created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComplianceItemResponse'

  /api/v1/compliance/items/batch:
    post:
      tags: [Compliance]
      operationId: createComplianceItems
      summary: Create multiple compliance items in batch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/CreateComplianceItemRequest'
      responses:
        '201':
          description: Compliance items created
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ComplianceItemResponse'

  /api/v1/compliance/items/job/{jobId}:
    get:
      tags: [Compliance]
      operationId: getComplianceItemsForJob
      summary: List compliance items for a job (paginated)
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated compliance items
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseComplianceItemResponse'

  /api/v1/compliance/items/job/{jobId}/status/{status}:
    get:
      tags: [Compliance]
      operationId: getComplianceItemsByStatus
      summary: List compliance items for a job filtered by status
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: status
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ComplianceStatus'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated compliance items by status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseComplianceItemResponse'

  /api/v1/compliance/summary/job/{jobId}:
    get:
      tags: [Compliance]
      operationId: getComplianceSummary
      summary: Get compliance summary for a job
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Compliance summary
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  # ──────────────────────────────────────────────
  # Dependencies
  # ──────────────────────────────────────────────
  /api/v1/dependencies/scans:
    post:
      tags: [Dependencies]
      operationId: createDependencyScan
      summary: Create a dependency scan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDependencyScanRequest'
      responses:
        '201':
          description: Scan created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DependencyScanResponse'

  /api/v1/dependencies/scans/{scanId}:
    get:
      tags: [Dependencies]
      operationId: getDependencyScan
      summary: Get a dependency scan by ID
      parameters:
        - name: scanId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Scan details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DependencyScanResponse'

  /api/v1/dependencies/scans/project/{projectId}:
    get:
      tags: [Dependencies]
      operationId: getScansForProject
      summary: List dependency scans for a project (paginated)
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated scans
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseDependencyScanResponse'

  /api/v1/dependencies/scans/project/{projectId}/latest:
    get:
      tags: [Dependencies]
      operationId: getLatestDependencyScan
      summary: Get the latest dependency scan for a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Latest scan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DependencyScanResponse'

  /api/v1/dependencies/vulnerabilities:
    post:
      tags: [Dependencies]
      operationId: addVulnerability
      summary: Add a vulnerability to a dependency scan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateVulnerabilityRequest'
      responses:
        '201':
          description: Vulnerability added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VulnerabilityResponse'

  /api/v1/dependencies/vulnerabilities/batch:
    post:
      tags: [Dependencies]
      operationId: addVulnerabilities
      summary: Add multiple vulnerabilities in batch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/CreateVulnerabilityRequest'
      responses:
        '201':
          description: Vulnerabilities added
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VulnerabilityResponse'

  /api/v1/dependencies/vulnerabilities/scan/{scanId}:
    get:
      tags: [Dependencies]
      operationId: getVulnerabilities
      summary: List vulnerabilities for a scan (paginated)
      parameters:
        - name: scanId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated vulnerabilities
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseVulnerabilityResponse'

  /api/v1/dependencies/vulnerabilities/scan/{scanId}/severity/{severity}:
    get:
      tags: [Dependencies]
      operationId: getVulnerabilitiesBySeverity
      summary: List vulnerabilities for a scan filtered by severity
      parameters:
        - name: scanId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: severity
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Severity'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated vulnerabilities by severity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseVulnerabilityResponse'

  /api/v1/dependencies/vulnerabilities/scan/{scanId}/open:
    get:
      tags: [Dependencies]
      operationId: getOpenVulnerabilities
      summary: List open vulnerabilities for a scan (paginated)
      parameters:
        - name: scanId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated open vulnerabilities
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseVulnerabilityResponse'

  /api/v1/dependencies/vulnerabilities/{vulnerabilityId}/status:
    put:
      tags: [Dependencies]
      operationId: updateVulnerabilityStatus
      summary: Update the status of a vulnerability
      parameters:
        - name: vulnerabilityId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/VulnerabilityStatus'
      responses:
        '200':
          description: Vulnerability status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VulnerabilityResponse'

  # ──────────────────────────────────────────────
  # Tech Debt
  # ──────────────────────────────────────────────
  /api/v1/tech-debt:
    post:
      tags: [Tech Debt]
      operationId: createTechDebtItem
      summary: Create a tech debt item
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTechDebtItemRequest'
      responses:
        '201':
          description: Tech debt item created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TechDebtItemResponse'

  /api/v1/tech-debt/batch:
    post:
      tags: [Tech Debt]
      operationId: createTechDebtItems
      summary: Create multiple tech debt items in batch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/CreateTechDebtItemRequest'
      responses:
        '201':
          description: Tech debt items created
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TechDebtItemResponse'

  /api/v1/tech-debt/{itemId}:
    get:
      tags: [Tech Debt]
      operationId: getTechDebtItem
      summary: Get a tech debt item by ID
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Tech debt item details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TechDebtItemResponse'
    delete:
      tags: [Tech Debt]
      operationId: deleteTechDebtItem
      summary: Delete a tech debt item
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Tech debt item deleted

  /api/v1/tech-debt/project/{projectId}:
    get:
      tags: [Tech Debt]
      operationId: getTechDebtForProject
      summary: List tech debt items for a project (paginated)
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated tech debt items
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseTechDebtItemResponse'

  /api/v1/tech-debt/project/{projectId}/status/{status}:
    get:
      tags: [Tech Debt]
      operationId: getTechDebtByStatus
      summary: List tech debt items for a project filtered by status
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: status
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/DebtStatus'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated tech debt items by status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseTechDebtItemResponse'

  /api/v1/tech-debt/project/{projectId}/category/{category}:
    get:
      tags: [Tech Debt]
      operationId: getTechDebtByCategory
      summary: List tech debt items for a project filtered by category
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: category
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/DebtCategory'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated tech debt items by category
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseTechDebtItemResponse'

  /api/v1/tech-debt/{itemId}/status:
    put:
      tags: [Tech Debt]
      operationId: updateTechDebtStatus
      summary: Update the status of a tech debt item
      parameters:
        - name: itemId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTechDebtStatusRequest'
      responses:
        '200':
          description: Tech debt status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TechDebtItemResponse'

  /api/v1/tech-debt/project/{projectId}/summary:
    get:
      tags: [Tech Debt]
      operationId: getDebtSummary
      summary: Get tech debt summary for a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Tech debt summary
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  # ──────────────────────────────────────────────
  # Remediation Tasks
  # ──────────────────────────────────────────────
  /api/v1/tasks:
    post:
      tags: [Remediation Tasks]
      operationId: createTask
      summary: Create a remediation task
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTaskRequest'
      responses:
        '201':
          description: Task created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskResponse'

  /api/v1/tasks/batch:
    post:
      tags: [Remediation Tasks]
      operationId: createTasks
      summary: Create multiple remediation tasks in batch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/CreateTaskRequest'
      responses:
        '201':
          description: Tasks created
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TaskResponse'

  /api/v1/tasks/job/{jobId}:
    get:
      tags: [Remediation Tasks]
      operationId: getTasksForJob
      summary: List tasks for a job (paginated)
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated tasks
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseTaskResponse'

  /api/v1/tasks/{taskId}:
    get:
      tags: [Remediation Tasks]
      operationId: getTask
      summary: Get a task by ID
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Task details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskResponse'
    put:
      tags: [Remediation Tasks]
      operationId: updateTask
      summary: Update a remediation task
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTaskRequest'
      responses:
        '200':
          description: Task updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskResponse'

  /api/v1/tasks/assigned-to-me:
    get:
      tags: [Remediation Tasks]
      operationId: getAssignedTasks
      summary: List tasks assigned to the current user (paginated)
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated tasks assigned to current user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseTaskResponse'

  # ──────────────────────────────────────────────
  # Health Monitor
  # ──────────────────────────────────────────────
  /api/v1/health-monitor/schedules:
    post:
      tags: [Health Monitor]
      operationId: createHealthSchedule
      summary: Create a health monitoring schedule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateHealthScheduleRequest'
      responses:
        '201':
          description: Schedule created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthScheduleResponse'

  /api/v1/health-monitor/schedules/project/{projectId}:
    get:
      tags: [Health Monitor]
      operationId: getSchedulesForProject
      summary: List health schedules for a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Health schedules
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/HealthScheduleResponse'

  /api/v1/health-monitor/schedules/{scheduleId}:
    put:
      tags: [Health Monitor]
      operationId: updateHealthSchedule
      summary: Update the active state of a health schedule
      parameters:
        - name: scheduleId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: active
          in: query
          required: true
          schema:
            type: boolean
      responses:
        '200':
          description: Schedule updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthScheduleResponse'
    delete:
      tags: [Health Monitor]
      operationId: deleteHealthSchedule
      summary: Delete a health schedule
      parameters:
        - name: scheduleId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Schedule deleted

  /api/v1/health-monitor/snapshots:
    post:
      tags: [Health Monitor]
      operationId: createHealthSnapshot
      summary: Create a health snapshot
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateHealthSnapshotRequest'
      responses:
        '201':
          description: Snapshot created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthSnapshotResponse'

  /api/v1/health-monitor/snapshots/project/{projectId}:
    get:
      tags: [Health Monitor]
      operationId: getHealthSnapshots
      summary: List health snapshots for a project (paginated)
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Paginated health snapshots
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseHealthSnapshotResponse'

  /api/v1/health-monitor/snapshots/project/{projectId}/latest:
    get:
      tags: [Health Monitor]
      operationId: getLatestHealthSnapshot
      summary: Get the latest health snapshot for a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Latest snapshot
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthSnapshotResponse'

  /api/v1/health-monitor/snapshots/project/{projectId}/trend:
    get:
      tags: [Health Monitor]
      operationId: getHealthTrend
      summary: Get health score trend for a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            format: int32
            default: 30
      responses:
        '200':
          description: Health trend snapshots
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/HealthSnapshotResponse'

  # ──────────────────────────────────────────────
  # Metrics
  # ──────────────────────────────────────────────
  /api/v1/metrics/project/{projectId}:
    get:
      tags: [Metrics]
      operationId: getProjectMetrics
      summary: Get aggregated metrics for a project
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Project metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectMetricsResponse'

  /api/v1/metrics/team/{teamId}:
    get:
      tags: [Metrics]
      operationId: getTeamMetrics
      summary: Get aggregated metrics for a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Team metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamMetricsResponse'

  /api/v1/metrics/project/{projectId}/trend:
    get:
      tags: [Metrics]
      operationId: getMetricsHealthTrend
      summary: Get health score trend for a project over days
      parameters:
        - name: projectId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: days
          in: query
          schema:
            type: integer
            format: int32
            default: 30
      responses:
        '200':
          description: Health trend snapshots
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/HealthSnapshotResponse'

  # ──────────────────────────────────────────────
  # Reports
  # ──────────────────────────────────────────────
  /api/v1/reports/job/{jobId}/agent/{agentType}:
    post:
      tags: [Reports]
      operationId: uploadAgentReport
      summary: Upload an agent markdown report
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: agentType
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/AgentType'
      requestBody:
        required: true
        content:
          text/plain:
            schema:
              type: string
      responses:
        '201':
          description: Report uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  s3Key:
                    type: string

  /api/v1/reports/job/{jobId}/summary:
    post:
      tags: [Reports]
      operationId: uploadSummaryReport
      summary: Upload a job summary report
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          text/plain:
            schema:
              type: string
      responses:
        '201':
          description: Summary uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  s3Key:
                    type: string

  /api/v1/reports/download:
    get:
      tags: [Reports]
      operationId: downloadReport
      summary: Download a markdown report by S3 key
      parameters:
        - name: s3Key
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Markdown report content
          content:
            text/markdown:
              schema:
                type: string

  /api/v1/reports/job/{jobId}/spec:
    post:
      tags: [Reports]
      operationId: uploadSpecification
      summary: Upload a specification file (multipart)
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: Specification uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  s3Key:
                    type: string

  /api/v1/reports/spec/download:
    get:
      tags: [Reports]
      operationId: downloadSpecification
      summary: Download a specification file by S3 key
      parameters:
        - name: s3Key
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Specification file bytes
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  # ──────────────────────────────────────────────
  # Integrations
  # ──────────────────────────────────────────────
  /api/v1/integrations/github/{teamId}:
    post:
      tags: [Integrations]
      operationId: createGitHubConnection
      summary: Create a GitHub connection for a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGitHubConnectionRequest'
      responses:
        '201':
          description: GitHub connection created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitHubConnectionResponse'
    get:
      tags: [Integrations]
      operationId: getGitHubConnections
      summary: List GitHub connections for a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: GitHub connections
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GitHubConnectionResponse'

  /api/v1/integrations/github/{teamId}/{connectionId}:
    get:
      tags: [Integrations]
      operationId: getGitHubConnection
      summary: Get a GitHub connection by ID
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: connectionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: GitHub connection details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GitHubConnectionResponse'
    delete:
      tags: [Integrations]
      operationId: deleteGitHubConnection
      summary: Delete a GitHub connection
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: connectionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: GitHub connection deleted

  /api/v1/integrations/jira/{teamId}:
    post:
      tags: [Integrations]
      operationId: createJiraConnection
      summary: Create a Jira connection for a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateJiraConnectionRequest'
      responses:
        '201':
          description: Jira connection created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JiraConnectionResponse'
    get:
      tags: [Integrations]
      operationId: getJiraConnections
      summary: List Jira connections for a team
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Jira connections
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JiraConnectionResponse'

  /api/v1/integrations/jira/{teamId}/{connectionId}:
    get:
      tags: [Integrations]
      operationId: getJiraConnection
      summary: Get a Jira connection by ID
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: connectionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Jira connection details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JiraConnectionResponse'
    delete:
      tags: [Integrations]
      operationId: deleteJiraConnection
      summary: Delete a Jira connection
      parameters:
        - name: teamId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: connectionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Jira connection deleted

components:
  # ──────────────────────────────────────────────
  # Security Schemes
  # ──────────────────────────────────────────────
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  # ──────────────────────────────────────────────
  # Reusable Parameters
  # ──────────────────────────────────────────────
  parameters:
    PageParam:
      name: page
      in: query
      schema:
        type: integer
        format: int32
        default: 0
    SizeParam:
      name: size
      in: query
      schema:
        type: integer
        format: int32
        default: 20

  # ──────────────────────────────────────────────
  # Schemas
  # ──────────────────────────────────────────────
  schemas:

    # ─── Enums ───────────────────────────────────
    AgentResult:
      type: string
      enum: [PASS, WARN, FAIL]

    AgentStatus:
      type: string
      enum: [PENDING, RUNNING, COMPLETED, FAILED]

    AgentType:
      type: string
      enum: [SECURITY, CODE_QUALITY, BUILD_HEALTH, COMPLETENESS, API_CONTRACT, TEST_COVERAGE, UI_UX, DOCUMENTATION, DATABASE, PERFORMANCE, DEPENDENCY, ARCHITECTURE]

    BusinessImpact:
      type: string
      enum: [LOW, MEDIUM, HIGH, CRITICAL]

    ComplianceStatus:
      type: string
      enum: [MET, PARTIAL, MISSING, NOT_APPLICABLE]

    DebtCategory:
      type: string
      enum: [ARCHITECTURE, CODE, TEST, DEPENDENCY, DOCUMENTATION]

    DebtStatus:
      type: string
      enum: [IDENTIFIED, PLANNED, IN_PROGRESS, RESOLVED]

    DirectiveCategory:
      type: string
      enum: [ARCHITECTURE, STANDARDS, CONVENTIONS, CONTEXT, OTHER]

    DirectiveScope:
      type: string
      enum: [TEAM, PROJECT, USER]

    Effort:
      type: string
      enum: [S, M, L, XL]

    FindingStatus:
      type: string
      enum: [OPEN, ACKNOWLEDGED, FALSE_POSITIVE, FIXED, WONT_FIX]

    GitHubAuthType:
      type: string
      enum: [PAT, OAUTH, SSH]

    InvitationStatus:
      type: string
      enum: [PENDING, ACCEPTED, EXPIRED]

    JobMode:
      type: string
      enum: [AUDIT, COMPLIANCE, BUG_INVESTIGATE, REMEDIATE, TECH_DEBT, DEPENDENCY, HEALTH_MONITOR]

    JobResult:
      type: string
      enum: [PASS, WARN, FAIL]

    JobStatus:
      type: string
      enum: [PENDING, RUNNING, COMPLETED, FAILED, CANCELLED]

    Priority:
      type: string
      enum: [P0, P1, P2, P3]

    ScheduleType:
      type: string
      enum: [DAILY, WEEKLY, ON_COMMIT]

    Scope:
      type: string
      enum: [SYSTEM, TEAM, USER]

    Severity:
      type: string
      enum: [CRITICAL, HIGH, MEDIUM, LOW]

    SpecType:
      type: string
      enum: [OPENAPI, MARKDOWN, SCREENSHOT, FIGMA]

    TaskStatus:
      type: string
      enum: [PENDING, ASSIGNED, EXPORTED, JIRA_CREATED, COMPLETED]

    TeamRole:
      type: string
      enum: [OWNER, ADMIN, MEMBER, VIEWER]

    VulnerabilityStatus:
      type: string
      enum: [OPEN, UPDATING, SUPPRESSED, RESOLVED]

    # ─── Request DTOs ────────────────────────────
    RegisterRequest:
      type: object
      required: [email, password, displayName]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
        displayName:
          type: string
          maxLength: 100

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    RefreshTokenRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken:
          type: string

    ChangePasswordRequest:
      type: object
      required: [currentPassword, newPassword]
      properties:
        currentPassword:
          type: string
        newPassword:
          type: string
          minLength: 8

    # ─── MFA Schemas ──────────────────────────────
    MfaSetupRequest:
      type: object
      required: [password]
      properties:
        password:
          type: string
          description: Current account password for re-verification

    MfaVerifyRequest:
      type: object
      required: [code]
      properties:
        code:
          type: string
          description: 6-digit TOTP code from authenticator app, or 6-digit email verification code

    MfaLoginRequest:
      type: object
      required: [challengeToken, code]
      properties:
        challengeToken:
          type: string
          description: MFA challenge JWT token received from login
        code:
          type: string
          description: 6-digit TOTP code, 6-digit email code, or 8-digit recovery code

    MfaSetupResponse:
      type: object
      properties:
        secret:
          type: string
          description: TOTP secret key (Base32 encoded)
        qrCodeUri:
          type: string
          description: Data URI of QR code PNG image for scanning
        recoveryCodes:
          type: array
          items:
            type: string
          description: 8 one-time recovery codes (8 digits each)

    MfaStatusResponse:
      type: object
      properties:
        mfaEnabled:
          type: boolean
        mfaMethod:
          type: string
          enum: [NONE, TOTP, EMAIL]
          description: The active MFA method
        recoveryCodesRemaining:
          type: integer
          description: Number of unused recovery codes remaining (null when MFA disabled)
          nullable: true

    MfaEmailSetupRequest:
      type: object
      required: [password]
      properties:
        password:
          type: string
          description: Current account password for re-verification

    MfaResendRequest:
      type: object
      required: [challengeToken]
      properties:
        challengeToken:
          type: string
          description: MFA challenge JWT token received from login

    MfaRecoveryResponse:
      type: object
      properties:
        recoveryCodes:
          type: array
          items:
            type: string
          description: 8 newly generated one-time recovery codes

    PasswordResetRequest:
      type: object
      required: [email]
      properties:
        email:
          type: string
          format: email

    AdminUpdateUserRequest:
      type: object
      properties:
        isActive:
          type: boolean

    UpdateSystemSettingRequest:
      type: object
      required: [key, value]
      properties:
        key:
          type: string
          maxLength: 200
        value:
          type: string
          maxLength: 5000

    UpdateUserRequest:
      type: object
      properties:
        displayName:
          type: string
          maxLength: 100
        avatarUrl:
          type: string
          maxLength: 500

    CreateTeamRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 100
        description:
          type: string
          maxLength: 5000
        teamsWebhookUrl:
          type: string
          maxLength: 500

    UpdateTeamRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
        description:
          type: string
          maxLength: 5000
        teamsWebhookUrl:
          type: string
          maxLength: 500

    InviteMemberRequest:
      type: object
      required: [email, role]
      properties:
        email:
          type: string
          format: email
        role:
          $ref: '#/components/schemas/TeamRole'

    UpdateMemberRoleRequest:
      type: object
      required: [role]
      properties:
        role:
          $ref: '#/components/schemas/TeamRole'

    CreateProjectRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 5000
        githubConnectionId:
          type: string
          format: uuid
        repoUrl:
          type: string
          maxLength: 2000
        repoFullName:
          type: string
          maxLength: 200
        defaultBranch:
          type: string
          maxLength: 200
        jiraConnectionId:
          type: string
          format: uuid
        jiraProjectKey:
          type: string
          maxLength: 50
        jiraDefaultIssueType:
          type: string
          maxLength: 200
        jiraLabels:
          type: array
          maxItems: 100
          items:
            type: string
            maxLength: 100
        jiraComponent:
          type: string
          maxLength: 200
        techStack:
          type: string
          maxLength: 5000

    UpdateProjectRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 5000
        githubConnectionId:
          type: string
          format: uuid
        repoUrl:
          type: string
          maxLength: 2000
        repoFullName:
          type: string
          maxLength: 200
        defaultBranch:
          type: string
          maxLength: 200
        jiraConnectionId:
          type: string
          format: uuid
        jiraProjectKey:
          type: string
          maxLength: 50
        jiraDefaultIssueType:
          type: string
          maxLength: 200
        jiraLabels:
          type: array
          maxItems: 100
          items:
            type: string
            maxLength: 100
        jiraComponent:
          type: string
          maxLength: 200
        techStack:
          type: string
          maxLength: 5000
        isArchived:
          type: boolean

    CreateDirectiveRequest:
      type: object
      required: [name, contentMd, scope]
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 5000
        contentMd:
          type: string
          maxLength: 50000
        category:
          $ref: '#/components/schemas/DirectiveCategory'
        scope:
          $ref: '#/components/schemas/DirectiveScope'
        teamId:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid

    UpdateDirectiveRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 5000
        contentMd:
          type: string
          maxLength: 50000
        category:
          $ref: '#/components/schemas/DirectiveCategory'

    AssignDirectiveRequest:
      type: object
      required: [projectId, directiveId]
      properties:
        projectId:
          type: string
          format: uuid
        directiveId:
          type: string
          format: uuid
        enabled:
          type: boolean

    CreatePersonaRequest:
      type: object
      required: [name, contentMd, scope]
      properties:
        name:
          type: string
          maxLength: 100
        agentType:
          $ref: '#/components/schemas/AgentType'
        description:
          type: string
          maxLength: 5000
        contentMd:
          type: string
          maxLength: 50000
        scope:
          $ref: '#/components/schemas/Scope'
        teamId:
          type: string
          format: uuid
        isDefault:
          type: boolean

    UpdatePersonaRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
        description:
          type: string
          maxLength: 5000
        contentMd:
          type: string
          maxLength: 50000
        isDefault:
          type: boolean

    CreateJobRequest:
      type: object
      required: [projectId, mode]
      properties:
        projectId:
          type: string
          format: uuid
        mode:
          $ref: '#/components/schemas/JobMode'
        name:
          type: string
          maxLength: 200
        branch:
          type: string
          maxLength: 200
        configJson:
          type: string
          maxLength: 50000
        jiraTicketKey:
          type: string
          maxLength: 200

    UpdateJobRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/JobStatus'
        summaryMd:
          type: string
          maxLength: 50000
        overallResult:
          $ref: '#/components/schemas/JobResult'
        healthScore:
          type: integer
          format: int32
        totalFindings:
          type: integer
          format: int32
        criticalCount:
          type: integer
          format: int32
        highCount:
          type: integer
          format: int32
        mediumCount:
          type: integer
          format: int32
        lowCount:
          type: integer
          format: int32
        completedAt:
          type: string
          format: date-time
        startedAt:
          type: string
          format: date-time

    CreateAgentRunRequest:
      type: object
      required: [jobId, agentType]
      properties:
        jobId:
          type: string
          format: uuid
        agentType:
          $ref: '#/components/schemas/AgentType'

    UpdateAgentRunRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/AgentStatus'
        result:
          $ref: '#/components/schemas/AgentResult'
        reportS3Key:
          type: string
          maxLength: 1000
        score:
          type: integer
          format: int32
        findingsCount:
          type: integer
          format: int32
        criticalCount:
          type: integer
          format: int32
        highCount:
          type: integer
          format: int32
        completedAt:
          type: string
          format: date-time
        startedAt:
          type: string
          format: date-time

    CreateBugInvestigationRequest:
      type: object
      required: [jobId]
      properties:
        jobId:
          type: string
          format: uuid
        jiraKey:
          type: string
          maxLength: 200
        jiraSummary:
          type: string
          maxLength: 500
        jiraDescription:
          type: string
          maxLength: 50000
        jiraCommentsJson:
          type: string
          maxLength: 50000
        jiraAttachmentsJson:
          type: string
          maxLength: 50000
        jiraLinkedIssues:
          type: string
          maxLength: 50000
        additionalContext:
          type: string
          maxLength: 50000

    UpdateBugInvestigationRequest:
      type: object
      properties:
        rcaMd:
          type: string
          maxLength: 50000
        impactAssessmentMd:
          type: string
          maxLength: 50000
        rcaS3Key:
          type: string
          maxLength: 1000
        rcaPostedToJira:
          type: boolean
        fixTasksCreatedInJira:
          type: boolean

    CreateFindingRequest:
      type: object
      required: [jobId, agentType, severity, title]
      properties:
        jobId:
          type: string
          format: uuid
        agentType:
          $ref: '#/components/schemas/AgentType'
        severity:
          $ref: '#/components/schemas/Severity'
        title:
          type: string
          maxLength: 500
        description:
          type: string
          maxLength: 5000
        filePath:
          type: string
          maxLength: 1000
        lineNumber:
          type: integer
          format: int32
        recommendation:
          type: string
          maxLength: 5000
        evidence:
          type: string
          maxLength: 50000
        effortEstimate:
          $ref: '#/components/schemas/Effort'
        debtCategory:
          $ref: '#/components/schemas/DebtCategory'

    UpdateFindingStatusRequest:
      type: object
      required: [status]
      properties:
        status:
          $ref: '#/components/schemas/FindingStatus'

    BulkUpdateFindingsRequest:
      type: object
      required: [findingIds, status]
      properties:
        findingIds:
          type: array
          minItems: 1
          maxItems: 100
          items:
            type: string
            format: uuid
        status:
          $ref: '#/components/schemas/FindingStatus'

    CreateSpecificationRequest:
      type: object
      required: [jobId, name, s3Key]
      properties:
        jobId:
          type: string
          format: uuid
        name:
          type: string
          maxLength: 200
        specType:
          $ref: '#/components/schemas/SpecType'
        s3Key:
          type: string
          maxLength: 1000

    CreateComplianceItemRequest:
      type: object
      required: [jobId, requirement, status]
      properties:
        jobId:
          type: string
          format: uuid
        requirement:
          type: string
          maxLength: 5000
        specId:
          type: string
          format: uuid
        status:
          $ref: '#/components/schemas/ComplianceStatus'
        evidence:
          type: string
          maxLength: 50000
        agentType:
          $ref: '#/components/schemas/AgentType'
        notes:
          type: string
          maxLength: 5000

    CreateDependencyScanRequest:
      type: object
      required: [projectId]
      properties:
        projectId:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        manifestFile:
          type: string
          maxLength: 200
        totalDependencies:
          type: integer
          format: int32
        outdatedCount:
          type: integer
          format: int32
        vulnerableCount:
          type: integer
          format: int32
        scanDataJson:
          type: string
          maxLength: 50000

    CreateVulnerabilityRequest:
      type: object
      required: [scanId, dependencyName, severity]
      properties:
        scanId:
          type: string
          format: uuid
        dependencyName:
          type: string
          maxLength: 200
        currentVersion:
          type: string
          maxLength: 50
        fixedVersion:
          type: string
          maxLength: 50
        cveId:
          type: string
          maxLength: 50
        severity:
          $ref: '#/components/schemas/Severity'
        description:
          type: string
          maxLength: 5000

    CreateTechDebtItemRequest:
      type: object
      required: [projectId, category, title]
      properties:
        projectId:
          type: string
          format: uuid
        category:
          $ref: '#/components/schemas/DebtCategory'
        title:
          type: string
          maxLength: 500
        description:
          type: string
          maxLength: 5000
        filePath:
          type: string
          maxLength: 1000
        effortEstimate:
          $ref: '#/components/schemas/Effort'
        businessImpact:
          $ref: '#/components/schemas/BusinessImpact'
        firstDetectedJobId:
          type: string
          format: uuid

    UpdateTechDebtStatusRequest:
      type: object
      required: [status]
      properties:
        status:
          $ref: '#/components/schemas/DebtStatus'
        resolvedJobId:
          type: string
          format: uuid

    CreateTaskRequest:
      type: object
      required: [jobId, taskNumber, title]
      properties:
        jobId:
          type: string
          format: uuid
        taskNumber:
          type: integer
          format: int32
        title:
          type: string
          maxLength: 500
        description:
          type: string
          maxLength: 5000
        promptMd:
          type: string
          maxLength: 50000
        promptS3Key:
          type: string
          maxLength: 1000
        findingIds:
          type: array
          maxItems: 100
          items:
            type: string
            format: uuid
        priority:
          $ref: '#/components/schemas/Priority'

    UpdateTaskRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/TaskStatus'
        assignedTo:
          type: string
          format: uuid
        jiraKey:
          type: string
          maxLength: 200

    CreateHealthScheduleRequest:
      type: object
      required: [projectId, scheduleType, agentTypes]
      properties:
        projectId:
          type: string
          format: uuid
        scheduleType:
          $ref: '#/components/schemas/ScheduleType'
        cronExpression:
          type: string
          maxLength: 200
        agentTypes:
          type: array
          minItems: 1
          maxItems: 20
          items:
            $ref: '#/components/schemas/AgentType'

    CreateHealthSnapshotRequest:
      type: object
      required: [projectId, healthScore]
      properties:
        projectId:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        healthScore:
          type: integer
          format: int32
        findingsBySeverity:
          type: string
          maxLength: 5000
        techDebtScore:
          type: integer
          format: int32
        dependencyScore:
          type: integer
          format: int32
        testCoveragePercent:
          type: number

    CreateGitHubConnectionRequest:
      type: object
      required: [name, authType, credentials]
      properties:
        name:
          type: string
          maxLength: 100
        authType:
          $ref: '#/components/schemas/GitHubAuthType'
        credentials:
          type: string
          maxLength: 10000
        githubUsername:
          type: string
          maxLength: 200

    CreateJiraConnectionRequest:
      type: object
      required: [name, instanceUrl, email, apiToken]
      properties:
        name:
          type: string
          maxLength: 100
        instanceUrl:
          type: string
          maxLength: 500
        email:
          type: string
          format: email
        apiToken:
          type: string
          maxLength: 10000

    UpdateNotificationPreferenceRequest:
      type: object
      required: [eventType]
      properties:
        eventType:
          type: string
          maxLength: 200
        inApp:
          type: boolean
        email:
          type: boolean

    # ─── Response DTOs ───────────────────────────
    AuthResponse:
      type: object
      description: >-
        Authentication response. For normal logins, contains token, refreshToken, and user.
        When MFA is required, contains mfaRequired=true and mfaChallengeToken instead.
        For email MFA challenges, also includes maskedEmail.
      properties:
        token:
          type: string
          description: JWT access token (null when MFA challenge is required)
        refreshToken:
          type: string
          description: JWT refresh token (null when MFA challenge is required)
        user:
          $ref: '#/components/schemas/UserResponse'
        mfaRequired:
          type: boolean
          description: True when the user has MFA enabled and must complete verification
        mfaChallengeToken:
          type: string
          description: Short-lived JWT challenge token for MFA login (5 min expiry)
        maskedEmail:
          type: string
          description: Masked email address for email MFA challenges (e.g., "a***@example.com")

    UserResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        displayName:
          type: string
        avatarUrl:
          type: string
        isActive:
          type: boolean
        mfaEnabled:
          type: boolean
          description: Whether multi-factor authentication is enabled on this account
        mfaMethod:
          type: string
          enum: [NONE, TOTP, EMAIL]
          description: The active MFA method for this account
        lastLoginAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    AuditLogResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        userId:
          type: string
          format: uuid
        userName:
          type: string
        teamId:
          type: string
          format: uuid
        action:
          type: string
        entityType:
          type: string
        entityId:
          type: string
          format: uuid
        details:
          type: string
        ipAddress:
          type: string
        createdAt:
          type: string
          format: date-time

    SystemSettingResponse:
      type: object
      properties:
        key:
          type: string
        value:
          type: string
        updatedBy:
          type: string
          format: uuid
        updatedAt:
          type: string
          format: date-time

    TeamResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        ownerId:
          type: string
          format: uuid
        ownerName:
          type: string
        teamsWebhookUrl:
          type: string
        memberCount:
          type: integer
          format: int32
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TeamMemberResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        displayName:
          type: string
        email:
          type: string
        avatarUrl:
          type: string
        role:
          $ref: '#/components/schemas/TeamRole'
        joinedAt:
          type: string
          format: date-time

    InvitationResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        role:
          $ref: '#/components/schemas/TeamRole'
        status:
          $ref: '#/components/schemas/InvitationStatus'
        invitedByName:
          type: string
        expiresAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    ProjectResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        teamId:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        githubConnectionId:
          type: string
          format: uuid
        repoUrl:
          type: string
        repoFullName:
          type: string
        defaultBranch:
          type: string
        jiraConnectionId:
          type: string
          format: uuid
        jiraProjectKey:
          type: string
        jiraDefaultIssueType:
          type: string
        jiraLabels:
          type: array
          items:
            type: string
        jiraComponent:
          type: string
        techStack:
          type: string
        healthScore:
          type: integer
          format: int32
        lastAuditAt:
          type: string
          format: date-time
        isArchived:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    DirectiveResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        contentMd:
          type: string
        category:
          $ref: '#/components/schemas/DirectiveCategory'
        scope:
          $ref: '#/components/schemas/DirectiveScope'
        teamId:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        createdBy:
          type: string
          format: uuid
        createdByName:
          type: string
        version:
          type: integer
          format: int32
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ProjectDirectiveResponse:
      type: object
      properties:
        projectId:
          type: string
          format: uuid
        directiveId:
          type: string
          format: uuid
        directiveName:
          type: string
        category:
          $ref: '#/components/schemas/DirectiveCategory'
        enabled:
          type: boolean

    PersonaResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        agentType:
          $ref: '#/components/schemas/AgentType'
        description:
          type: string
        contentMd:
          type: string
        scope:
          $ref: '#/components/schemas/Scope'
        teamId:
          type: string
          format: uuid
        createdBy:
          type: string
          format: uuid
        createdByName:
          type: string
        isDefault:
          type: boolean
        version:
          type: integer
          format: int32
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    JobResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        projectName:
          type: string
        mode:
          $ref: '#/components/schemas/JobMode'
        status:
          $ref: '#/components/schemas/JobStatus'
        name:
          type: string
        branch:
          type: string
        configJson:
          type: string
        summaryMd:
          type: string
        overallResult:
          $ref: '#/components/schemas/JobResult'
        healthScore:
          type: integer
          format: int32
        totalFindings:
          type: integer
          format: int32
        criticalCount:
          type: integer
          format: int32
        highCount:
          type: integer
          format: int32
        mediumCount:
          type: integer
          format: int32
        lowCount:
          type: integer
          format: int32
        jiraTicketKey:
          type: string
        startedBy:
          type: string
          format: uuid
        startedByName:
          type: string
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    JobSummaryResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectName:
          type: string
        mode:
          $ref: '#/components/schemas/JobMode'
        status:
          $ref: '#/components/schemas/JobStatus'
        name:
          type: string
        overallResult:
          $ref: '#/components/schemas/JobResult'
        healthScore:
          type: integer
          format: int32
        totalFindings:
          type: integer
          format: int32
        criticalCount:
          type: integer
          format: int32
        completedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    AgentRunResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        agentType:
          $ref: '#/components/schemas/AgentType'
        status:
          $ref: '#/components/schemas/AgentStatus'
        result:
          $ref: '#/components/schemas/AgentResult'
        reportS3Key:
          type: string
        score:
          type: integer
          format: int32
        findingsCount:
          type: integer
          format: int32
        criticalCount:
          type: integer
          format: int32
        highCount:
          type: integer
          format: int32
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time

    BugInvestigationResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        jiraKey:
          type: string
        jiraSummary:
          type: string
        jiraDescription:
          type: string
        additionalContext:
          type: string
        rcaMd:
          type: string
        impactAssessmentMd:
          type: string
        rcaS3Key:
          type: string
        rcaPostedToJira:
          type: boolean
        fixTasksCreatedInJira:
          type: boolean
        createdAt:
          type: string
          format: date-time

    FindingResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        agentType:
          $ref: '#/components/schemas/AgentType'
        severity:
          $ref: '#/components/schemas/Severity'
        title:
          type: string
        description:
          type: string
        filePath:
          type: string
        lineNumber:
          type: integer
          format: int32
        recommendation:
          type: string
        evidence:
          type: string
        effortEstimate:
          $ref: '#/components/schemas/Effort'
        debtCategory:
          $ref: '#/components/schemas/DebtCategory'
        status:
          $ref: '#/components/schemas/FindingStatus'
        statusChangedBy:
          type: string
          format: uuid
        statusChangedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    SpecificationResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        name:
          type: string
        specType:
          $ref: '#/components/schemas/SpecType'
        s3Key:
          type: string
        createdAt:
          type: string
          format: date-time

    ComplianceItemResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        requirement:
          type: string
        specId:
          type: string
          format: uuid
        specName:
          type: string
        status:
          $ref: '#/components/schemas/ComplianceStatus'
        evidence:
          type: string
        agentType:
          $ref: '#/components/schemas/AgentType'
        notes:
          type: string
        createdAt:
          type: string
          format: date-time

    DependencyScanResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        manifestFile:
          type: string
        totalDependencies:
          type: integer
          format: int32
        outdatedCount:
          type: integer
          format: int32
        vulnerableCount:
          type: integer
          format: int32
        createdAt:
          type: string
          format: date-time

    VulnerabilityResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        scanId:
          type: string
          format: uuid
        dependencyName:
          type: string
        currentVersion:
          type: string
        fixedVersion:
          type: string
        cveId:
          type: string
        severity:
          $ref: '#/components/schemas/Severity'
        description:
          type: string
        status:
          $ref: '#/components/schemas/VulnerabilityStatus'
        createdAt:
          type: string
          format: date-time

    TechDebtItemResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        category:
          $ref: '#/components/schemas/DebtCategory'
        title:
          type: string
        description:
          type: string
        filePath:
          type: string
        effortEstimate:
          $ref: '#/components/schemas/Effort'
        businessImpact:
          $ref: '#/components/schemas/BusinessImpact'
        status:
          $ref: '#/components/schemas/DebtStatus'
        firstDetectedJobId:
          type: string
          format: uuid
        resolvedJobId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TaskResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        taskNumber:
          type: integer
          format: int32
        title:
          type: string
        description:
          type: string
        promptMd:
          type: string
        promptS3Key:
          type: string
        findingIds:
          type: array
          items:
            type: string
            format: uuid
        priority:
          $ref: '#/components/schemas/Priority'
        status:
          $ref: '#/components/schemas/TaskStatus'
        assignedTo:
          type: string
          format: uuid
        assignedToName:
          type: string
        jiraKey:
          type: string
        createdAt:
          type: string
          format: date-time

    HealthScheduleResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        scheduleType:
          $ref: '#/components/schemas/ScheduleType'
        cronExpression:
          type: string
        agentTypes:
          type: array
          items:
            $ref: '#/components/schemas/AgentType'
        isActive:
          type: boolean
        lastRunAt:
          type: string
          format: date-time
        nextRunAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    HealthSnapshotResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        healthScore:
          type: integer
          format: int32
        findingsBySeverity:
          type: string
        techDebtScore:
          type: integer
          format: int32
        dependencyScore:
          type: integer
          format: int32
        testCoveragePercent:
          type: number
        capturedAt:
          type: string
          format: date-time

    GitHubConnectionResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        teamId:
          type: string
          format: uuid
        name:
          type: string
        authType:
          $ref: '#/components/schemas/GitHubAuthType'
        githubUsername:
          type: string
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time

    JiraConnectionResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        teamId:
          type: string
          format: uuid
        name:
          type: string
        instanceUrl:
          type: string
        email:
          type: string
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time

    ProjectMetricsResponse:
      type: object
      properties:
        projectId:
          type: string
          format: uuid
        projectName:
          type: string
        currentHealthScore:
          type: integer
          format: int32
        previousHealthScore:
          type: integer
          format: int32
        totalJobs:
          type: integer
          format: int32
        totalFindings:
          type: integer
          format: int32
        openCritical:
          type: integer
          format: int32
        openHigh:
          type: integer
          format: int32
        techDebtItemCount:
          type: integer
          format: int32
        openVulnerabilities:
          type: integer
          format: int32
        lastAuditAt:
          type: string
          format: date-time

    TeamMetricsResponse:
      type: object
      properties:
        teamId:
          type: string
          format: uuid
        totalProjects:
          type: integer
          format: int32
        totalJobs:
          type: integer
          format: int32
        totalFindings:
          type: integer
          format: int32
        averageHealthScore:
          type: number
          format: double
        projectsBelowThreshold:
          type: integer
          format: int32
        openCriticalFindings:
          type: integer
          format: int32

    NotificationPreferenceResponse:
      type: object
      properties:
        eventType:
          type: string
        inApp:
          type: boolean
        email:
          type: boolean

    ErrorResponse:
      type: object
      properties:
        status:
          type: integer
          format: int32
        message:
          type: string

    # ─── Paginated Response Wrappers ─────────────
    # Spring Page<T> used by AdminController
    PageUserResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/UserResponse'
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        number:
          type: integer
          format: int32
        last:
          type: boolean

    PageAuditLogResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/AuditLogResponse'
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        number:
          type: integer
          format: int32
        last:
          type: boolean

    # PageResponse<T> used by most other controllers
    PageResponseProjectResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/ProjectResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponsePersonaResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/PersonaResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseJobSummaryResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/JobSummaryResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseFindingResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/FindingResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseSpecificationResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/SpecificationResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseComplianceItemResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/ComplianceItemResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseDependencyScanResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/DependencyScanResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseVulnerabilityResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/VulnerabilityResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseTechDebtItemResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/TechDebtItemResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseTaskResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/TaskResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean

    PageResponseHealthSnapshotResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/HealthSnapshotResponse'
        page:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        isLast:
          type: boolean
